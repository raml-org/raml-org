---
layout: page
title: "Exploring and Verifying APIs with Anypoint API Notebook"
date: 2014-07-10
categories : [Tooling]
author: Norberto L. Herz
tags: [ MuleSoft, Open Source ]
comments: true
---

<h1 dir="ltr">
  Introduction
</h1>

<span style="line-height: 1.5;">I think it’s worth starting this article by mentioning <em>Why am I writing it</em>. I've been working with APIs for a long time. I'm talking about back when building an API was painful, and testing was close to impossible.</span> Since working with RAML, I’ve discovered an amazingly vast amount of tools available, thanks to its community.  One tool in particular enables me to grab any existing RESTful API (built or documented/proxied with RAML), and start utilizing it without having to install any software, tools, or libraries on my machine.  More importantly, I didn’t even need research anything before using the API (I didn’t even have to read the API documentation).

# What is it

<p dir="ltr">
  Anypoint API Notebook is part of <a href="http://www.mulesoft.com/platform/api">MuleSoft's Anypoint platform for APIs</a>, and it could be considered as one of the supporting last steps in MuleSoft’s "The Agile API Build Lifecycle: Validate or not."
</p>

# What can I do

Avoiding the theoretical debate of any of the steps, and instead focusing on "Validate or not", let's think about the possibility of having or discovering an API, and being able to immediately try it out and test it programmatically. Or even further, to write a simple script that calls different methods of this API in the middle of a particular logic. Or what about writing a full test suite that can be ran to detect if some method stopped responding as expected, or in other words, the API has changed?

# In action

<p dir="ltr">
  For this example, I will be using Jukebox, the Business Case as presented in the <a href="http://raml.org/docs-200.html">RAML 200 tutorial</a>. However, the RAML file might vary a little bit, since I'm not focusing on the topics of that tutorial.
</p>

<p dir="ltr">
  For simplicity, I will be using Anypoint Designer and API Portal for creating the API, publishing it, and most important "Mocking it". As I said before, we will be utilizing existing, live APIs to see how our API works with them as a HTTP service.
</p>

# Use Case

<p dir="ltr">
  Build a music Jukebox. While the physical device will be responsible for displaying the information and capturing the user input, it will be relying on your API to retrieve the information requested. The Jukebox needs to be able to:
</p>

*   Show the full list of artists.
*   Show the full list of albums.
*   Show the list of artists by nationality.
*   Show the list of albums by genre.
*   Search for a song by title.
*   Show a particular artist's albums collection.
*   Show a particular album's songs list.
*   Play a song (by specifying the song id).
*   Enter new Artists, Albums and Songs (only authenticated users).

**Consideration**: This is a jukebox, not a command line. People in pubs might be unable to type lots of characters, so a user friendly UI (paging, image-based, etc) would be very appreciated.

# Key Concepts

*   [AnyPoint API Notebook][1] is an example of [Literate Programming][2]: the adopted approach is to combine code cells and text cells where to write and explain the program.
*   RAML API generic client: The key factor of this tool, is the capability of exposing a specific DSL to call the API methods of each API. For example: "client.artists.get()" will retrieve a collection of artists, and the DSL was automatically generated by the tool based on the RAML definition.
*   Execution responses: When running the contents of a cell code, the tool adds a response area where you can see what was the actual response for a particular call (or general execution).

 [1]: https://api-notebook.anypoint.mulesoft.com/
 [2]: http://en.wikipedia.org/wiki/Literate_programming

# Hands on

<p dir="ltr">
  So, let's explore what's been done.
</p>

*   To understand the Jukebox API used in the example, you can access its API portal.
*   Check out the its API portal for visual and interactive documentation.
*   Check out the its API portal itself.
*   You are now ready to utilize [the notebook][3].

 [3]: https://api-notebook.anypoint.mulesoft.com/notebooks#385bebd014f27e72f72f

# The notebook, step by step

<h3 dir="ltr">
  Text cells
</h3>

<p dir="ltr">
  As explained before, you can include <em>text cells</em> at any part of your notebook if you need to explain what your code is trying to do.
</p>

![Create text cell](/post_images/2014-07-10-post-notebook-text-cell.png)

<h3 dir="ltr">
  The client
</h3>

<p dir="ltr">
  Initializing the Client that will provide the DSL for calling your API methods is as simple shown in the next image
</p>

![Create client](/post_images/2014-07-10-post-notebook-create-client.png)

<p dir="ltr">
  In this case, "JukeboxAPI" is the name of the variable that will contain the client instance (first parameter). The second parameter is the URL of the API RAML Definition.
</p>

<p dir="ltr">
  <strong>Consideration</strong>: RAML defines the URL of the running API by setting the property baseUri. In this case, you will see something like this: http://mocksvc.mulesoft.com/mocks/957041d5-7af4-49f2-ae66-03da18de6983. This is basically because the running API is a mock generated with AnyPoint API Designer. If you are working with a real API, you just need to point the <em>baseUri</em> parameter to the URL of that API.
</p>

<h3 dir="ltr">
  External libraries
</h3>

<p dir="ltr">
  You can load external modules to use these on your notebook. A great use of this capability is including an assertion framework, allowing you to write a "test suite".
</p>

![Load external library](/post_images/2014-07-10-post-notebook-load-ext-libs.png)

### Invoking methods with URI Parameters

<p dir="ltr">
  Assuming that we have this URL resource representation "myAPI/artists/{artistId}" supporting the HTTP GET method, invoking it would be as simple as:
</p>

![Invoke with URI parameter](/post_images/2014-07-10-post-notebook-invoke-with-uri-param.png)

<p dir="ltr">
  where "123" is the value for the "artistId" parameter. In other words, it would be doing a HTTP GET myAPI/artists/123.
</p>

### Body and Query Parameters

<p dir="ltr">
  Following the previous section approach, let's consider the URL resource representation "myAPI/artists" supporting the HTTP POST method, and expecting:
</p>

*   The Artist JSON representation as a body parameter.
*   An Access Token (for authorizing the operation) as a query parameter.

![Invoke post method](/post_images/2014-07-10-post-notebook-invoke-post.png)

<p dir="ltr">
  The first parameter of ".post" is the http body parameter. The second one, is a JSON specifying several options. For adding the Query Parameters, the "query" option is used, and the expected value is a "key:value JSON".
</p>

### Assertions

<p dir="ltr">
  Since we have included the Chai Assertion Framework, we now can use it to compare the actual responses with the expected ones:
</p>

![Create client](/post_images/2014-07-10-post-notebook-assert.png)

# Next Steps

<p dir="ltr">
  With the information provided in this article, you should be able to read the <a href="https://api-notebook.anypoint.mulesoft.com/notebooks#385bebd014f27e72f72f">entire example notebook</a>, run it (yes, it's the main purpose of this tool), edit it, and finally, write your own.
</p>

I hope you find this to be useful. Feel free to [contact us][4] if you have questions. Cheers!

 [4]: mailto:info@raml.org